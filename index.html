<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario CFIE Valladolid 2025-26</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .alert {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px;
            border-radius: 5px;
        }

        .alert strong {
            color: #856404;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Calendario */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .month-card {
            border: 2px solid #dee2e6;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .month-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
        }

        .month-body {
            padding: 15px;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            padding: 8px 0;
            font-size: 0.9em;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95em;
            position: relative;
        }

        .day:not(.empty):hover {
            background: #e9ecef;
            transform: scale(1.1);
        }

        .day.empty {
            cursor: default;
        }

        .day.festivo {
            background: #ff6b6b;
            color: white;
            font-weight: bold;
        }

        .day.vacaciones {
            background: #ffd43b;
            color: #333;
            font-weight: bold;
        }

        .day.no-lectivo {
            background: #74c0fc;
            color: white;
        }

        .day.today {
            border: 3px solid #667eea;
            font-weight: bold;
        }

        .day.weekend {
            background: #ffe5e5;
            color: #c92a2a;
        }

        /* Leyenda */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
        }

        /* Lista de eventos */
        .events-list {
            display: grid;
            gap: 15px;
        }

        .event-card {
            border-left: 5px solid #667eea;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .event-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .event-card.festivo {
            border-left-color: #ff6b6b;
        }

        .event-card.vacaciones {
            border-left-color: #ffd43b;
        }

        .event-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .event-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .event-type {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            background: #667eea;
            color: white;
        }

        /* Calculadora */
        .calculator {
            max-width: 900px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .result-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-label {
            font-weight: 600;
            color: #495057;
        }

        .result-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        /* Tabla de d√≠as de la semana en calculadora */
        .weekdays-calc-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .weekdays-calc-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
        }

        .weekdays-calc-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
            font-weight: 600;
        }

        .weekdays-calc-table td:first-child {
            text-align: left;
            color: #495057;
        }

        .weekdays-calc-table td:nth-child(2) {
            color: #ff6b6b;
        }

        .weekdays-calc-table td:nth-child(3) {
            color: #ffd43b;
        }

        .weekdays-calc-table td:nth-child(4) {
            color: #667eea;
        }

        .weekdays-calc-table tr:last-child td {
            border-bottom: none;
        }

        .weekdays-calc-table tr:hover {
            background: #f8f9fa;
        }

        /* Estad√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* B√∫squeda */
        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        /* D√≠as laborables por mes */
        .workdays-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .workdays-table th,
        .workdays-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .workdays-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .workdays-table tr:hover {
            background: #f8f9fa;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .calendar-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tab {
                padding: 12px 15px;
                font-size: 14px;
            }

            .content {
                padding: 15px;
            }

            .weekdays-calc-table th {
                font-size: 0.8em;
                padding: 10px 5px;
            }

            .weekdays-calc-table td {
                padding: 10px 5px;
                font-size: 0.9em;
            }
        }

        /* Tooltip con position fixed - SOLUCI√ìN DEFINITIVA */
        #globalTooltip {
            position: fixed;
            background-color: #333;
            color: white;
            text-align: center;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            white-space: nowrap;
            z-index: 10000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            display: none;
        }

        #globalTooltip.show {
            display: block;
            opacity: 1;
        }

        .countdown {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .period-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .period-section h3 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .period-info {
            display: grid;
            gap: 10px;
        }

        .period-info-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <!-- Tooltip global -->
    <div id="globalTooltip"></div>

    <div class="container">
        <div class="header">
            <h1>üìÖ Calendario Trabajo</h1>
            <p>CFIE Valladolid ‚Ä¢ Curso 2025-26</p>
        </div>

        <div class="alert">
            <strong>‚ö†Ô∏è Importante:</strong> Verifica las fechas oficiales en
            <a href="https://www.educa.jcyl.es/es/calendario-escolar" target="_blank" style="color: #0056b3;">
                https://www.educa.jcyl.es/es/calendario-escolar
            </a>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('calendario')">üìÜ Calendario</button>
            <button class="tab" onclick="showTab('periodos')">üìã Per√≠odos</button>
            <button class="tab" onclick="showTab('eventos')">üéâ Eventos</button>
            <button class="tab" onclick="showTab('calculadora')">üßÆ Calculadora</button>
            <button class="tab" onclick="showTab('estadisticas')">üìä Estad√≠sticas</button>
            <button class="tab" onclick="showTab('dias-laborables')">üìÖ D√≠as Lectivos</button>
        </div>

        <div class="content">
            <!-- Tab Calendario -->
            <div id="calendario" class="tab-content active">
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6b6b;"></div>
                        <span>Festivos</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffd43b;"></div>
                        <span>Vacaciones</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #74c0fc;"></div>
                        <span>No Lectivo</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffe5e5;"></div>
                        <span>Fin de Semana</span>
                    </div>
                </div>

                <div id="countdown" class="countdown"></div>

                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <!-- Tab Per√≠odos -->
            <div id="periodos" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #667eea;">üìã Per√≠odos del Curso Escolar</h2>

                <div class="period-section">
                    <h3>üéì Per√≠odo Lectivo</h3>
                    <div class="period-info">
                        <div class="period-info-item">
                            <span><strong>Inicio de curso:</strong></span>
                            <span id="courseStartDate"></span>
                        </div>
                        <div class="period-info-item">
                            <span><strong>Fin de curso:</strong></span>
                            <span id="courseEndDate"></span>
                        </div>
                    </div>
                </div>

                <div class="period-section">
                    <h3>üéÑ Vacaciones de Navidad</h3>
                    <div class="period-info" id="navidadInfo"></div>
                </div>

                <div class="period-section">
                    <h3>üê£ Vacaciones de Semana Santa</h3>
                    <div class="period-info" id="semanaSantaInfo"></div>
                </div>

                <div class="period-section">
                    <h3>üìö D√≠as No Lectivos</h3>
                    <div class="period-info" id="noLectivosInfo"></div>
                </div>
            </div>

            <!-- Tab Eventos -->
            <div id="eventos" class="tab-content">
                <div class="search-box">
                    <input type="text" id="searchEvents" placeholder="üîç Buscar eventos..." onkeyup="filterEvents()">
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterByType('all')">Todos</button>
                    <button class="filter-btn" onclick="filterByType('festivo')">Festivos</button>
                    <button class="filter-btn" onclick="filterByType('vacaciones')">Vacaciones</button>
                    <button class="filter-btn" onclick="filterByType('no-lectivo')">No Lectivos</button>
                </div>

                <div class="events-list" id="eventsList"></div>
            </div>

            <!-- Tab Calculadora -->
            <div id="calculadora" class="tab-content">
                <div class="calculator">
                    <h2 style="margin-bottom: 20px; color: #667eea;">üßÆ Calculadora de D√≠as</h2>

                    <div class="form-group">
                        <label>Fecha Inicio:</label>
                        <input type="date" id="startDate">
                    </div>

                    <div class="form-group">
                        <label>Fecha Fin:</label>
                        <input type="date" id="endDate">
                    </div>

                    <button class="btn" onclick="calculateDays()">Calcular</button>

                    <div class="results" id="calculatorResults">
                        <h3 style="margin-bottom: 20px; color: #495057;">Resultados:</h3>
                        <div id="resultsContent"></div>
                    </div>
                </div>
            </div>

            <!-- Tab Estad√≠sticas -->
            <div id="estadisticas" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #667eea;">üìä Estad√≠sticas del Curso 2025-26</h2>

                <div class="stats-grid" id="statsGrid"></div>

                <div style="margin-top: 40px;">
                    <h3 style="margin-bottom: 20px; color: #495057;">üìà Distribuci√≥n Mensual</h3>
                    <div id="monthlyDistribution"></div>
                </div>
            </div>

            <!-- Tab D√≠as Laborables -->
            <div id="dias-laborables" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #667eea;">üìÖ D√≠as Lectivos por Mes</h2>
                <table class="workdays-table" id="workdaysTable"></table>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // üìù CONFIGURACI√ìN DEL CALENDARIO
        // ============================================
        // ACTUALIZA ESTAS FECHAS CON LAS OFICIALES DE:
        // https://www.educa.jcyl.es/es/calendario-escolar

        // Funci√≥n helper para convertir fecha a string sin problemas de zona horaria
        function dateToString(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Funci√≥n helper para crear fecha local desde string
        function stringToDate(dateStr) {
            const [year, month, day] = dateStr.split('-').map(num => parseInt(num));
            return new Date(year, month - 1, day);
        }

        // Per√≠odo lectivo
        const courseStart = stringToDate('2025-09-01'); // AJUSTAR FECHA OFICIAL
        const courseEnd = stringToDate('2026-06-30');   // AJUSTAR FECHA OFICIAL

        // Festivos (d√≠as festivos individuales)
        const festivos = [
            // Septiembre 2025
            { date: '2025-09-08', name: 'Patrona de Valladolid', type: 'festivo' },

            // Octubre 2025
            { date: '2025-10-12', name: 'Fiesta Nacional de Espa√±a', type: 'festivo' },
            { date: '2025-10-13', name: 'Fiesta Nacional de Espa√±a', type: 'festivo' },

            // Noviembre 2025
            { date: '2025-11-01', name: 'Todos los Santos', type: 'festivo' },

            // Diciembre 2025
            { date: '2025-12-06', name: 'D√≠a de la Constituci√≥n', type: 'festivo' },
            { date: '2025-12-08', name: 'Inmaculada Concepci√≥n', type: 'festivo' },

            // Enero 2026
            { date: '2026-01-01', name: 'A√±o Nuevo', type: 'festivo' },
            { date: '2026-01-06', name: 'Reyes Magos', type: 'festivo' },

            // Abril 2026
            { date: '2026-04-03', name: 'Viernes Santo', type: 'festivo' },
            { date: '2026-04-23', name: 'D√≠a de Castilla y Le√≥n', type: 'festivo' },

            // Mayo 2026
            { date: '2026-05-01', name: 'D√≠a del Trabajador', type: 'festivo' },
            { date: '2026-05-13', name: 'Patr√≥n de Valladolid', type: 'festivo' },

            // A√ëADE AQU√ç M√ÅS FESTIVOS OFICIALES
        ];

        // Per√≠odos de vacaciones (rangos de fechas)
        const vacaciones = [
            // Vacaciones de Navidad
            {
                start: '2025-12-20',
                end: '2026-01-07',
                name: 'Vacaciones de Navidad'
            },
             // Vacaciones de Semana Santa
            {
                start: '2026-03-27',
                end: '2026-04-06',
                name: 'Vacaciones de Semana Santa'
            },

            // A√ëADE AQU√ç M√ÅS PER√çODOS DE VACACIONES
        ];

        // D√≠as no lectivos (festivos escolares, puentes, etc.)
        const noLectivos = [
            { date: '2025-10-31', name: 'D√≠a del docente', type: 'no-lectivo' },
            { date: '2025-12-07', name: 'Puente Constituci√≥n', type: 'no-lectivo' },
            { date: '2026-02-16', name: 'Lunes de Carnaval', type: 'no-lectivo' },
            { date: '2026-02-17', name: 'Martes de Carnaval', type: 'no-lectivo' },
            { date: '2026-04-24', name: 'Puente D√≠a de la Comunidad', type: 'no-lectivo' },

            // A√ëADE AQU√ç M√ÅS D√çAS NO LECTIVOS
        ];

        // ============================================
        // FIN DE LA CONFIGURACI√ìN
        // ============================================

        let allEvents = [];
        let currentFilter = 'all';

        // Tooltip global
        let globalTooltip;

        function showTooltip(element, text) {
            if (!globalTooltip) {
                globalTooltip = document.getElementById('globalTooltip');
            }

            const rect = element.getBoundingClientRect();
            globalTooltip.textContent = text;
            globalTooltip.classList.add('show');

            // Posicionar arriba del elemento
            const tooltipRect = globalTooltip.getBoundingClientRect();
            let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
            let top = rect.top - tooltipRect.height - 8;

            // Ajustar si se sale por la izquierda
            if (left < 5) {
                left = 5;
            }

            // Ajustar si se sale por la derecha
            if (left + tooltipRect.width > window.innerWidth - 5) {
                left = window.innerWidth - tooltipRect.width - 5;
            }

            // Si se sale por arriba, ponerlo abajo
            if (top < 5) {
                top = rect.bottom + 8;
            }

            globalTooltip.style.left = left + 'px';
            globalTooltip.style.top = top + 'px';
        }

        function hideTooltip() {
            if (globalTooltip) {
                globalTooltip.classList.remove('show');
            }
        }

        // Inicializar
        function init() {
            generateAllEvents();
            renderCalendar();
            renderPeriods();
            renderEventsList();
            renderStats();
            renderWorkdaysTable();
            updateCountdown();
            setInterval(updateCountdown, 60000);

            // Establecer fecha por defecto en calculadora
            document.getElementById('startDate').value = dateToString(courseStart);
            document.getElementById('endDate').value = dateToString(courseEnd);
        }

        function generateAllEvents() {
            allEvents = [];

            // A√±adir festivos
            festivos.forEach(f => {
                allEvents.push({
                    date: f.date,
                    name: f.name,
                    type: 'festivo'
                });
            });

            // A√±adir vacaciones
            vacaciones.forEach(v => {
                let current = stringToDate(v.start);
                const end = stringToDate(v.end);

                while (current <= end) {
                    const dateStr = dateToString(current);
                    allEvents.push({
                        date: dateStr,
                        name: v.name,
                        type: 'vacaciones',
                        periodStart: v.start,
                        periodEnd: v.end
                    });
                    current.setDate(current.getDate() + 1);
                }
            });

            // A√±adir no lectivos
            noLectivos.forEach(n => {
                allEvents.push({
                    date: n.date,
                    name: n.name,
                    type: 'no-lectivo'
                });
            });

            // Ordenar por fecha
            allEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        function renderPeriods() {
            // Per√≠odo lectivo
            document.getElementById('courseStartDate').textContent =
                courseStart.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('courseEndDate').textContent =
                courseEnd.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            // Vacaciones de Navidad
            const navidad = vacaciones.find(v => v.name.includes('Navidad'));
            if (navidad) {
                const navidadStart = stringToDate(navidad.start);
                const navidadEnd = stringToDate(navidad.end);
                const navidadDays = Math.ceil((navidadEnd - navidadStart) / (1000 * 60 * 60 * 24)) + 1;

                document.getElementById('navidadInfo').innerHTML = `
                    <div class="period-info-item">
                        <span><strong>Inicio:</strong></span>
                        <span>${navidadStart.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                    </div>
                    <div class="period-info-item">
                        <span><strong>Fin:</strong></span>
                        <span>${navidadEnd.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                    </div>
                    <div class="period-info-item">
                        <span><strong>Duraci√≥n:</strong></span>
                        <span>${navidadDays} d√≠as</span>
                    </div>
                `;
            }

            // Vacaciones de Semana Santa
            const semanaSanta = vacaciones.find(v => v.name.includes('Semana Santa'));
            if (semanaSanta) {
                const ssStart = stringToDate(semanaSanta.start);
                const ssEnd = stringToDate(semanaSanta.end);
                const ssDays = Math.ceil((ssEnd - ssStart) / (1000 * 60 * 60 * 24)) + 1;

                document.getElementById('semanaSantaInfo').innerHTML = `
                    <div class="period-info-item">
                        <span><strong>Inicio:</strong></span>
                        <span>${ssStart.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                    </div>
                    <div class="period-info-item">
                        <span><strong>Fin:</strong></span>
                        <span>${ssEnd.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                    </div>
                    <div class="period-info-item">
                        <span><strong>Duraci√≥n:</strong></span>
                        <span>${ssDays} d√≠as</span>
                    </div>
                `;
            }

            // D√≠as no lectivos
            let noLectivosHTML = '';
            noLectivos.forEach(nl => {
                const nlDate = stringToDate(nl.date);
                noLectivosHTML += `
                    <div class="period-info-item">
                        <span><strong>${nl.name}</strong></span>
                        <span>${nlDate.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                    </div>
                `;
            });
            document.getElementById('noLectivosInfo').innerHTML = noLectivosHTML;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            let current = new Date(courseStart);
            current.setDate(1);

            const lastMonth = new Date(courseEnd);

            while (current <= lastMonth) {
                const monthCard = createMonthCard(current);
                grid.appendChild(monthCard);
                current.setMonth(current.getMonth() + 1);
            }
        }

        function createMonthCard(date) {
            const card = document.createElement('div');
            card.className = 'month-card';

            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

            const header = document.createElement('div');
            header.className = 'month-header';
            header.textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;

            const body = document.createElement('div');
            body.className = 'month-body';

            // D√≠as de la semana
            const weekdays = document.createElement('div');
            weekdays.className = 'weekdays';
            ['L', 'M', 'X', 'J', 'V', 'S', 'D'].forEach(day => {
                const wd = document.createElement('div');
                wd.className = 'weekday';
                wd.textContent = day;
                weekdays.appendChild(wd);
            });

            // D√≠as del mes
            const days = document.createElement('div');
            days.className = 'days';

            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);

            let startDay = firstDay.getDay();
            startDay = startDay === 0 ? 6 : startDay - 1;

            // D√≠as vac√≠os
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty';
                days.appendChild(emptyDay);
            }

            // D√≠as del mes
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day';
                dayDiv.textContent = day;

                const currentDate = new Date(date.getFullYear(), date.getMonth(), day);
                const dateStr = dateToString(currentDate);
                const dayOfWeek = currentDate.getDay();

                // Verificar si es fin de semana
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayDiv.classList.add('weekend');
                }

                // Verificar si es hoy
                if (dateToString(currentDate) === dateToString(today)) {
                    dayDiv.classList.add('today');
                }

                // Verificar eventos
                const events = allEvents.filter(e => e.date === dateStr);
                if (events.length > 0) {
                    const event = events[0];
                    dayDiv.classList.add(event.type);

                    // A√±adir eventos de tooltip
                    dayDiv.addEventListener('mouseenter', function(e) {
                        showTooltip(this, event.name);
                    });
                    dayDiv.addEventListener('mouseleave', hideTooltip);
                }

                days.appendChild(dayDiv);
            }

            body.appendChild(weekdays);
            body.appendChild(days);
            card.appendChild(header);
            card.appendChild(body);

            return card;
        }

        function renderEventsList() {
            const list = document.getElementById('eventsList');
            list.innerHTML = '';

            // Filtrar eventos √∫nicos
            const uniqueEvents = [];
            const seen = new Map();

            allEvents.forEach(event => {
                if (event.type === 'vacaciones') {
                    const key = event.name + event.periodStart;
                    if (!seen.has(key)) {
                        seen.set(key, true);
                        uniqueEvents.push({
                            ...event,
                            isRange: true
                        });
                    }
                } else {
                    uniqueEvents.push(event);
                }
            });

            uniqueEvents.forEach(event => {
                const card = document.createElement('div');
                card.className = `event-card ${event.type}`;
                card.dataset.type = event.type;
                card.dataset.name = event.name.toLowerCase();

                let dateStr;
                if (event.isRange) {
                    const startDate = stringToDate(event.periodStart);
                    const endDate = stringToDate(event.periodEnd);
                    dateStr = `${startDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })} - ${endDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' })}`;
                } else {
                    const date = stringToDate(event.date);
                    dateStr = date.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }

                const typeLabel = {
                    'festivo': 'FESTIVO',
                    'vacaciones': 'VACACIONES',
                    'no-lectivo': 'NO LECTIVO'
                }[event.type];

                card.innerHTML = `
                    <div class="event-date">${dateStr}</div>
                    <div class="event-title">${event.name}</div>
                    <span class="event-type">${typeLabel}</span>
                `;

                list.appendChild(card);
            });
        }

        function filterEvents() {
            const search = document.getElementById('searchEvents').value.toLowerCase();
            const cards = document.querySelectorAll('.event-card');

            cards.forEach(card => {
                const name = card.dataset.name;
                const type = card.dataset.type;

                const matchSearch = name.includes(search);
                const matchType = currentFilter === 'all' || type === currentFilter;

                card.style.display = matchSearch && matchType ? 'block' : 'none';
            });
        }

        function filterByType(type) {
            currentFilter = type;

            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            filterEvents();
        }

        function calculateDays() {
            const start = stringToDate(document.getElementById('startDate').value);
            const end = stringToDate(document.getElementById('endDate').value);

            if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                alert('Por favor, selecciona ambas fechas');
                return;
            }

            if (start > end) {
                alert('La fecha de inicio debe ser anterior a la fecha de fin');
                return;
            }

            const results = {
                totalDays: 0,
                totalDaysExcluding: 0,
                weekdays: {
                    monday: 0, tuesday: 0, wednesday: 0, thursday: 0, friday: 0,
                    saturday: 0, sunday: 0
                },
                weekdaysExcluding: {
                    monday: 0, tuesday: 0, wednesday: 0, thursday: 0, friday: 0
                },
                weekdaysFestivosNoLectivos: {
                    monday: 0, tuesday: 0, wednesday: 0, thursday: 0, friday: 0
                },
                weekdaysVacaciones: {
                    monday: 0, tuesday: 0, wednesday: 0, thursday: 0, friday: 0
                },
                festivos: 0,
                vacaciones: 0,
                noLectivos: 0
            };

            let current = new Date(start);
            const dayNames = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

            while (current <= end) {
                results.totalDays++;

                const dateStr = dateToString(current);
                const dayOfWeek = current.getDay();
                const dayName = dayNames[dayOfWeek];

                results.weekdays[dayName]++;

                const event = allEvents.find(e => e.date === dateStr);
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

                if (event) {
                    if (event.type === 'festivo') {
                        results.festivos++;
                        if (!isWeekend) {
                            results.weekdaysFestivosNoLectivos[dayName]++;
                        }
                    } else if (event.type === 'vacaciones') {
                        results.vacaciones++;
                        if (!isWeekend) {
                            results.weekdaysVacaciones[dayName]++;
                        }
                    } else if (event.type === 'no-lectivo') {
                        results.noLectivos++;
                        if (!isWeekend) {
                            results.weekdaysFestivosNoLectivos[dayName]++;
                        }
                    }
                } else if (!isWeekend) {
                    results.totalDaysExcluding++;
                }

                if (!isWeekend && !event) {
                    const weekdayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
                    if (weekdayNames.includes(dayName)) {
                        results.weekdaysExcluding[dayName]++;
                    }
                }

                current.setDate(current.getDate() + 1);
            }

            displayResults(results);
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('calculatorResults');
            const content = document.getElementById('resultsContent');

            const dayNamesEs = {
                monday: 'Lunes',
                tuesday: 'Martes',
                wednesday: 'Mi√©rcoles',
                thursday: 'Jueves',
                friday: 'Viernes'
            };

            content.innerHTML = `
                <div class="result-item">
                    <span class="result-label">üìÖ Total de d√≠as</span>
                    <span class="result-value">${results.totalDays}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">‚úÖ D√≠as lectivos (sin festivos ni vacaciones)</span>
                    <span class="result-value">${results.totalDaysExcluding}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">üéâ Festivos</span>
                    <span class="result-value">${results.festivos}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">üèñÔ∏è D√≠as de vacaciones</span>
                    <span class="result-value">${results.vacaciones}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">üìö D√≠as no lectivos</span>
                    <span class="result-value">${results.noLectivos}</span>
                </div>
                <hr style="margin: 20px 0; border: none; border-top: 2px solid #dee2e6;">
                <h4 style="margin-bottom: 15px; color: #495057;">Distribuci√≥n por d√≠a de la semana:</h4>
                <table class="weekdays-calc-table">
                    <thead>
                        <tr>
                            <th>D√çA</th>
                            <th>FESTIVOS Y NO LECTIVOS</th>
                            <th>VACACIONES</th>
                            <th>LECTIVOS</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(dayNamesEs).map(([day, label]) => `
                            <tr>
                                <td>${label}</td>
                                <td>${results.weekdaysFestivosNoLectivos[day]}</td>
                                <td>${results.weekdaysVacaciones[day]}</td>
                                <td>${results.weekdaysExcluding[day]}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            resultsDiv.classList.add('show');
        }

        function renderStats() {
            const stats = calculateCourseStats();
            const grid = document.getElementById('statsGrid');

            grid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.totalDays}</div>
                    <div class="stat-label">D√≠as Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.lectureDays}</div>
                    <div class="stat-label">D√≠as Lectivos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.festivos}</div>
                    <div class="stat-label">Festivos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.vacacionesDays}</div>
                    <div class="stat-label">D√≠as de Vacaciones</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.noLectivos}</div>
                    <div class="stat-label">D√≠as No Lectivos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.weekends}</div>
                    <div class="stat-label">Fines de Semana</div>
                </div>
            `;

            renderMonthlyDistribution(stats.monthlyStats);
        }

        function calculateCourseStats() {
            let current = new Date(courseStart);
            const end = new Date(courseEnd);

            const stats = {
                totalDays: 0,
                lectureDays: 0,
                festivos: 0,
                vacacionesDays: 0,
                noLectivos: 0,
                weekends: 0,
                monthlyStats: {}
            };

            while (current <= end) {
                stats.totalDays++;

                const dateStr = dateToString(current);
                const dayOfWeek = current.getDay();
                const monthKey = `${current.getFullYear()}-${String(current.getMonth() + 1).padStart(2, '0')}`;

                if (!stats.monthlyStats[monthKey]) {
                    stats.monthlyStats[monthKey] = {
                        total: 0,
                        lectivos: 0,
                        festivos: 0
                    };
                }

                stats.monthlyStats[monthKey].total++;

                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const event = allEvents.find(e => e.date === dateStr);

                if (isWeekend) {
                    stats.weekends++;
                } else if (event) {
                    if (event.type === 'festivo') {
                        stats.festivos++;
                        stats.monthlyStats[monthKey].festivos++;
                    } else if (event.type === 'vacaciones') {
                        stats.vacacionesDays++;
                    } else if (event.type === 'no-lectivo') {
                        stats.noLectivos++;
                        stats.monthlyStats[monthKey].festivos++;
                    }
                } else {
                    stats.lectureDays++;
                    stats.monthlyStats[monthKey].lectivos++;
                }

                current.setDate(current.getDate() + 1);
            }

            return stats;
        }

        function renderMonthlyDistribution(monthlyStats) {
            const container = document.getElementById('monthlyDistribution');
            const monthNames = {
                '09': 'Septiembre', '10': 'Octubre', '11': 'Noviembre', '12': 'Diciembre',
                '01': 'Enero', '02': 'Febrero', '03': 'Marzo', '04': 'Abril',
                '05': 'Mayo', '06': 'Junio'
            };

            let html = '<div style="display: grid; gap: 15px;">';

            Object.entries(monthlyStats).forEach(([month, stats]) => {
                const [year, monthNum] = month.split('-');
                const monthName = monthNames[monthNum];
                const percentage = stats.total > 0 ? ((stats.lectivos / stats.total) * 100).toFixed(1) : 0;

                html += `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong>${monthName} ${year}</strong>
                            <span>${stats.lectivos} d√≠as lectivos de ${stats.total}</span>
                        </div>
                        <div style="background: #dee2e6; height: 10px; border-radius: 5px; overflow: hidden;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                        height: 100%; width: ${percentage}%; transition: width 0.3s;"></div>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #6c757d;">
                            ${stats.festivos} festivos/no lectivos ‚Ä¢ ${percentage}% d√≠as lectivos
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        function renderWorkdaysTable() {
            const table = document.getElementById('workdaysTable');
            const stats = calculateCourseStats();

            const monthNames = {
                '09': 'Septiembre 2025', '10': 'Octubre 2025', '11': 'Noviembre 2025', '12': 'Diciembre 2025',
                '01': 'Enero 2026', '02': 'Febrero 2026', '03': 'Marzo 2026', '04': 'Abril 2026',
                '05': 'Mayo 2026', '06': 'Junio 2026'
            };

            let html = `
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>D√≠as Totales</th>
                        <th>D√≠as Lectivos</th>
                        <th>Festivos/No Lectivos</th>
                        <th>% Lectivos</th>
                    </tr>
                </thead>
                <tbody>
            `;

            Object.entries(stats.monthlyStats).forEach(([month, data]) => {
                const [year, monthNum] = month.split('-');
                const monthName = monthNames[monthNum];
                const percentage = data.total > 0 ? ((data.lectivos / data.total) * 100).toFixed(1) : 0;

                html += `
                    <tr>
                        <td><strong>${monthName}</strong></td>
                        <td>${data.total}</td>
                        <td style="color: #667eea; font-weight: bold;">${data.lectivos}</td>
                        <td>${data.festivos}</td>
                        <td>${percentage}%</td>
                    </tr>
                `;
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        function updateCountdown() {
            const now = new Date();
            const start = new Date(courseStart);
            const end = new Date(courseEnd);
            const countdown = document.getElementById('countdown');

            if (now < start) {
                const days = Math.ceil((start - now) / (1000 * 60 * 60 * 24));
                countdown.innerHTML = `‚è≥ Faltan <strong>${days} d√≠as</strong> para el inicio del curso`;
            } else if (now > end) {
                countdown.innerHTML = `üéì El curso ha finalizado`;
            } else {
                const days = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
                countdown.innerHTML = `üìö Quedan <strong>${days} d√≠as</strong> para el fin de curso`;
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
